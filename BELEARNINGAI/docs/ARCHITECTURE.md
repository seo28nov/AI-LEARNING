# üèó Ki·∫øn tr√∫c H·ªá th·ªëng BE Learning AI

T√†i li·ªáu m√¥ t·∫£ ki·∫øn tr√∫c t·ªïng th·ªÉ c·ªßa h·ªá th·ªëng h·ªçc t·∫≠p th√¥ng minh BE Learning AI.

## M·ª•c l·ª•c

1. [T·ªïng quan Ki·∫øn tr√∫c](#t·ªïng-quan-ki·∫øn-tr√∫c)
2. [C√°c T·∫ßng H·ªá th·ªëng](#c√°c-t·∫ßng-h·ªá-th·ªëng)
3. [Flow D·ªØ li·ªáu](#flow-d·ªØ-li·ªáu)
4. [Database Schema](#database-schema)
5. [Authentication & Authorization](#authentication--authorization)
6. [AI & RAG Pipeline](#ai--rag-pipeline)
7. [API Design](#api-design)
8. [Scalability](#scalability)

---

## T·ªïng quan Ki·∫øn tr√∫c

### M√¥ h√¨nh Ki·∫øn tr√∫c

BE Learning AI s·ª≠ d·ª•ng **Layered Architecture** (Ki·∫øn tr√∫c ph√¢n t·∫ßng) v·ªõi c√°c t·∫ßng r√µ r√†ng:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENT LAYER                          ‚îÇ
‚îÇ  (Web App, Mobile App, Admin Dashboard)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ HTTP/HTTPS
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      API GATEWAY LAYER                       ‚îÇ
‚îÇ  ‚Ä¢ NGINX Reverse Proxy                                      ‚îÇ
‚îÇ  ‚Ä¢ SSL/TLS Termination                                      ‚îÇ
‚îÇ  ‚Ä¢ Rate Limiting                                            ‚îÇ
‚îÇ  ‚Ä¢ Load Balancing                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    APPLICATION LAYER                         ‚îÇ
‚îÇ                      (FastAPI App)                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  MIDDLEWARE  ‚îÇ   ‚îÇ    ROUTERS    ‚îÇ   ‚îÇ  CONTROLLERS  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Auth/JWT   ‚îÇ‚îÄ‚îÄ‚ñ∂‚îÇ ‚Ä¢ 18 routers  ‚îÇ‚îÄ‚îÄ‚ñ∂‚îÇ ‚Ä¢ 18 ctrls   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ RBAC       ‚îÇ   ‚îÇ ‚Ä¢ /api/v1/*   ‚îÇ   ‚îÇ ‚Ä¢ Logic flow ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ CORS       ‚îÇ   ‚îÇ ‚Ä¢ REST API    ‚îÇ   ‚îÇ               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                   ‚îÇ
                                                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     SERVICE LAYER                            ‚îÇ
‚îÇ  ‚Ä¢ 11 Business Services                                     ‚îÇ
‚îÇ  ‚Ä¢ Business Logic                                           ‚îÇ
‚îÇ  ‚Ä¢ External API Integration                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  auth_service      user_service      course_service         ‚îÇ
‚îÇ  enrollment_srv    classes_service   progress_service       ‚îÇ
‚îÇ  quiz_service      assessment_srv    chat_service           ‚îÇ
‚îÇ  upload_service    analytics_service                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚ñº               ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DATA LAYER     ‚îÇ ‚îÇ  AI LAYER    ‚îÇ ‚îÇ  STORAGE LAYER  ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ              ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ  ‚Ä¢ MongoDB      ‚îÇ ‚îÇ ‚Ä¢ Google AI  ‚îÇ ‚îÇ ‚Ä¢ File Storage  ‚îÇ
‚îÇ  ‚Ä¢ Beanie ODM   ‚îÇ ‚îÇ ‚Ä¢ Gemini Pro ‚îÇ ‚îÇ ‚Ä¢ S3/Local      ‚îÇ
‚îÇ  ‚Ä¢ 16 Models    ‚îÇ ‚îÇ ‚Ä¢ Embeddings ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ              ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ  ‚Ä¢ Vector DB    ‚îÇ ‚îÇ ‚Ä¢ RAG System ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ  ‚Ä¢ Pinecone/    ‚îÇ ‚îÇ              ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ    Weaviate/    ‚îÇ ‚îÇ              ‚îÇ ‚îÇ                 ‚îÇ
‚îÇ   FAISS VDB    ‚îÇ ‚îÇ              ‚îÇ ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Tech Stack

| Component | Technology | Version |
|-----------|-----------|---------|
| **Framework** | FastAPI | 0.104.1 |
| **Language** | Python | 3.9+ |
| **Database** | MongoDB | 5.0+ |
| **ODM** | Beanie | 1.23.6 |
| **Auth** | JWT (python-jose) | 3.3.0 |
| **AI Engine** | Google Generative AI | 0.3.1 |
| **Vector DB** | FAISS (Facebook AI) | ‚úÖ |
| **Server** | Uvicorn | 0.24.0 |
| **Reverse Proxy** | NGINX | Latest |

---

## C√°c T·∫ßng H·ªá th·ªëng

### 1. Presentation Layer (Routers)

**Ch·ª©c nƒÉng:** ƒê·ªãnh nghƒ©a c√°c API endpoints, x·ª≠ l√Ω HTTP requests/responses

**Th√†nh ph·∫ßn:**
- 18 router modules trong `routers/`
- M·ªói router ƒë·∫£m nhi·ªám m·ªôt domain c·ª• th·ªÉ
- Prefix: `/api/v1/{domain}`

**V√≠ d·ª•:**
```python
# routers/courses_router.py
@router.get("/courses", response_model=dict)
async def list_courses(
    skip: int = 0,
    limit: int = 10,
    current_user: dict = Depends(get_current_user)
):
    return await course_controller.handle_list_courses(
        user_id=current_user["sub"],
        skip=skip,
        limit=limit
    )
```

**Router List:**
1. `auth_router.py` - Authentication
2. `users_router.py` - User management
3. `courses_router.py` - Course CRUD
4. `enrollment_router.py` - Course enrollment
5. `classes_router.py` - Class management
6. `quiz_router.py` - Quiz system
7. `chat_router.py` - AI chat
8. `ai_router.py` - AI features
9. `upload_router.py` - File uploads
10. `progress_router.py` - Learning progress
11. `notification_router.py` - Notifications
12. `dashboard_router.py` - Dashboard stats
13. `analytics_router.py` - Analytics
14. `assessments_router.py` - Skill assessment
15. `admin_router.py` - Admin functions
16. `search_router.py` - Search
17. `recommendation_router.py` - Recommendations
18. `permissions_router.py` - Permissions

### 2. Controller Layer

**Ch·ª©c nƒÉng:** ƒêi·ªÅu ph·ªëi request, g·ªçi services, x·ª≠ l√Ω exceptions

**Tr√°ch nhi·ªám:**
- Validate request data
- G·ªçi service functions
- Transform response format
- Handle business exceptions

**Pattern:**
```python
# controllers/course_controller.py
async def handle_create_course(payload: dict, user_id: str) -> dict:
    # 1. Validate
    if not payload.get("title"):
        raise HTTPException(400, "Title required")
    
    # 2. Call service
    course = await course_service.create_course(
        title=payload["title"],
        user_id=user_id
    )
    
    # 3. Return formatted response
    return course
```

### 3. Service Layer

**Ch·ª©c nƒÉng:** Business logic ch√≠nh, t√≠ch h·ª£p external services

**Services:**

#### auth_service.py
- ƒêƒÉng k√Ω/ƒëƒÉng nh·∫≠p users
- Generate JWT tokens
- Verify email
- Reset password
- Refresh tokens

#### user_service.py
- CRUD user profiles
- Change password
- Manage roles
- User activation/deactivation

#### course_service.py
- CRUD courses
- Publish/unpublish courses
- Duplicate courses
- List courses v·ªõi filters
- Course approval workflow

#### enrollment_service.py
- Enroll/unenroll courses
- Track enrollment status
- Progress tracking
- Get user enrollments

#### classes_service.py
- Create/manage classes
- Generate join codes
- Student roster
- Remove students

#### quiz_service.py
- Create quizzes
- Generate quizzes v·ªõi AI
- Submit quiz attempts
- Grade quizzes
- Quiz statistics

#### assessment_service.py
- Skill assessments
- Generate questions v·ªõi AI
- Evaluate answers
- Provide recommendations
- Track assessment history

#### chat_service.py
- Manage chat sessions
- Send/receive messages
- RAG integration (retrieve context)
- Generate AI responses
- Chat history

#### upload_service.py
- Handle file uploads
- Process documents
- Extract text
- Generate embeddings
- Store to vector DB

#### progress_service.py
- Track chapter progress
- Calculate completion rate
- Time tracking
- Learning streaks

#### analytics_service.py
- Student dashboards
- Instructor dashboards
- Admin system stats
- Course analytics
- User engagement metrics

### 4. Middleware Layer

**Ch·ª©c nƒÉng:** Cross-cutting concerns

#### auth.py
```python
async def get_current_user(token: str = Depends(oauth2_scheme)):
    """Verify JWT token v√† tr·∫£ v·ªÅ user info"""
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id = payload.get("sub")
        if not user_id:
            raise credentials_exception
        return payload
    except JWTError:
        raise credentials_exception
```

#### rbac.py
```python
def require_role(*allowed_roles: str):
    """Decorator ki·ªÉm tra role"""
    def decorator(func):
        async def wrapper(*args, **kwargs):
            current_user = kwargs.get("current_user")
            if current_user["role"] not in allowed_roles:
                raise HTTPException(403, "Forbidden")
            return await func(*args, **kwargs)
        return wrapper
    return decorator
```

### 5. Data Layer

**Database Models (16 models):**

```python
# models/models.py
class UserDocument(Document):
    email: str
    full_name: str
    hashed_password: str
    role: str  # admin, instructor, student
    is_active: bool
    is_verified: bool
    created_at: datetime
    
    class Settings:
        name = "users"
        indexes = [
            IndexModel([("email", 1)], unique=True),
            IndexModel([("role", 1)]),
        ]
```

**Models:**
1. `UserDocument` - Users
2. `CourseDocument` - Courses
3. `EnrollmentDocument` - Enrollments
4. `ClassDocument` - Classes
5. `QuizDocument` - Quizzes
6. `QuizAttemptDocument` - Quiz submissions
7. `AssessmentDocument` - Assessments
8. `ChatSessionDocument` - Chat sessions
9. `ChatMessageDocument` - Chat messages
10. `UploadDocument` - File uploads
11. `ProgressDocument` - Learning progress
12. `NotificationDocument` - Notifications
13. `AnalyticsDocument` - Analytics data
14. `PermissionDocument` - Permissions
15. `AdminLogDocument` - Admin audit logs
16. `RecommendationDocument` - Recommendations

---

## Flow D·ªØ li·ªáu

### 1. Authentication Flow

```
Client                  API                     Service                 Database
  ‚îÇ                      ‚îÇ                        ‚îÇ                       ‚îÇ
  ‚îú‚îÄ‚îÄPOST /auth/login‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                        ‚îÇ                       ‚îÇ
  ‚îÇ  {email, password}   ‚îÇ                        ‚îÇ                       ‚îÇ
  ‚îÇ                      ‚îú‚îÄ‚îÄhandle_login()‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                       ‚îÇ
  ‚îÇ                      ‚îÇ                        ‚îú‚îÄ‚îÄfind_user()‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
  ‚îÇ                      ‚îÇ                        ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄuser‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ                      ‚îÇ                        ‚îÇ                       ‚îÇ
  ‚îÇ                      ‚îÇ                        ‚îú‚îÄ‚îÄverify_password()    ‚îÇ
  ‚îÇ                      ‚îÇ                        ‚îÇ                       ‚îÇ
  ‚îÇ                      ‚îÇ                        ‚îú‚îÄ‚îÄcreate_tokens()      ‚îÇ
  ‚îÇ                      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄtokens‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                       ‚îÇ
  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ200 OK‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ                       ‚îÇ
  ‚îÇ  {access, refresh}   ‚îÇ                        ‚îÇ                       ‚îÇ
```

### 2. Create Course Flow (v·ªõi RAG indexing)

```
Client              API              Controller         Service           Vector DB
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îú‚îÄPOST /courses‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                   ‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îú‚îÄ‚îÄhandle_create()‚îÄ‚ñ∂‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îú‚îÄ‚îÄcreate_course()‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îú‚îÄ‚îÄsave to MongoDB ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îú‚îÄ‚îÄextract_text()  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îú‚îÄ‚îÄgenerate_embed()‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ                 ‚îú‚îÄ‚îÄindex_vectors()‚îÄ‚ñ∂‚îÇ
  ‚îÇ                  ‚îÇ                   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄcourse‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                  ‚îÇ
  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ201 Created‚îÄ‚îÄ‚î§                   ‚îÇ                 ‚îÇ                  ‚îÇ
```

### 3. Chat v·ªõi RAG Flow

```
Client          API           Controller      Chat Service    Search Service   Vector DB   AI
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îú‚îÄPOST /chat‚îÄ‚îÄ‚ñ∂‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ {message}    ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îú‚îÄhandle_send()‚îÄ‚ñ∂‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îú‚îÄsend_msg()‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îú‚îÄsearch()‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ                ‚îú‚îÄ‚îÄquery‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ‚óÄ‚îÄresults‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ‚óÄ‚îÄ‚îÄcontext‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îú‚îÄbuild_prompt() ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îú‚îÄgenerate()‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
  ‚îÇ              ‚îÇ                ‚îÇ               ‚îÇ‚óÄ‚îÄresponse‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ              ‚îÇ                ‚îÇ‚óÄ‚îÄ‚îÄmessage‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                ‚îÇ              ‚îÇ         ‚îÇ
  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ200 OK‚îÄ‚îÄ‚îÄ‚î§                ‚îÇ               ‚îÇ                ‚îÇ              ‚îÇ         ‚îÇ
```

---

## Database Schema

### Collections & Relationships

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    users    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ 1
       ‚îÇ
       ‚îÇ N
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     N      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   enrollments   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   courses    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ 1                            ‚îÇ 1
       ‚îÇ                              ‚îÇ
       ‚îÇ N                            ‚îÇ N
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    progress     ‚îÇ            ‚îÇ   quizzes    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     1     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ chat_session‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ chat_message ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     N     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ N
       ‚îÇ
       ‚îÇ 1
   ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ users ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ assessments ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ N
       ‚îÇ
       ‚îÇ 1
   ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ users ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Key Indexes

```python
# Performance-critical indexes
users.email (unique)
users.role
courses.instructor_id
courses.is_public
courses.category
enrollments.user_id + course_id (compound, unique)
quiz_attempts.quiz_id + user_id
chat_sessions.user_id
progress.user_id + course_id
```

---

## Authentication & Authorization

### JWT Token Structure

```json
{
  "sub": "user_id_123",
  "email": "user@example.com",
  "role": "student",
  "exp": 1234567890,
  "iat": 1234567890,
  "type": "access"
}
```

### RBAC Matrix

| Endpoint | Student | Instructor | Admin |
|----------|---------|------------|-------|
| GET /courses/public | ‚úÖ | ‚úÖ | ‚úÖ |
| POST /courses | ‚ùå | ‚úÖ | ‚úÖ |
| DELETE /courses/:id | ‚ùå | ‚úÖ (own) | ‚úÖ |
| GET /users | ‚ùå | ‚ùå | ‚úÖ |
| POST /classes | ‚ùå | ‚úÖ | ‚úÖ |
| POST /admin/* | ‚ùå | ‚ùå | ‚úÖ |
| POST /enrollment | ‚úÖ | ‚úÖ | ‚úÖ |
| POST /quiz/:id/submit | ‚úÖ | ‚úÖ | ‚úÖ |

### Security Features

- ‚úÖ Password hashing v·ªõi bcrypt (rounds=12)
- ‚úÖ JWT access token (30 mins expiry)
- ‚úÖ JWT refresh token (7 days expiry)
- ‚úÖ Token blacklist on logout
- ‚úÖ Email verification
- ‚úÖ Password reset flow
- ‚úÖ Rate limiting (60 req/min)
- ‚úÖ CORS whitelist
- ‚úÖ HTTPS only (production)
- ‚úÖ Input validation v·ªõi Pydantic

---

## AI & RAG Pipeline

### RAG Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    INDEXING PIPELINE                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Course Content ‚îÄ‚îÄ‚ñ∂ Extract Text ‚îÄ‚îÄ‚ñ∂ Chunk (500 words)
                                           ‚îÇ
                                           ‚ñº
                                    Generate Embeddings
                                    (Google AI - 768 dim)
                                           ‚îÇ
                                           ‚ñº
                                    Store in Vector DB
                                    (Pinecone/Weaviate)


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     QUERY PIPELINE                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

User Question ‚îÄ‚îÄ‚ñ∂ Generate Query Embedding ‚îÄ‚îÄ‚ñ∂ Vector Search
                                                      ‚îÇ
                                                      ‚ñº
                                               Top 3 Chunks
                                                      ‚îÇ
                                                      ‚ñº
                    Build Prompt with Context ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
                    Google Gemini Pro
                             ‚îÇ
                             ‚ñº
                    AI Response to User
```

### Embedding Model

- **Model:** `models/embedding-001` (Google AI)
- **Dimension:** 768
- **Task Types:** 
  - `retrieval_document` - cho course content
  - `retrieval_query` - cho user questions

### Vector Database Options

| Feature | Pinecone | Weaviate | FAISS |
|---------|----------|----------|-------|
| **Hosting** | Cloud | Cloud/Local | Local |
| **Setup** | Easy | Medium | Easiest |
| **Performance** | Excellent | Very Good | **Excellent** |
| **Cost** | Paid (free tier) | Paid (free tier) | **Free** |
| **Windows Support** | Good | Good | **Native** |
| **Build Requirements** | None | Docker | **None** |
| **Best for** | Production Scale | Flexible | **All Scenarios** |

---

## API Design

### RESTful Principles

‚úÖ **Resource-based URLs:**
```
/api/v1/courses
/api/v1/courses/{id}
/api/v1/users/{id}/enrollments
```

‚úÖ **HTTP Methods:**
- GET - Retrieve
- POST - Create
- PATCH - Partial update
- PUT - Full update
- DELETE - Remove

‚úÖ **Status Codes:**
- 200 - Success
- 201 - Created
- 400 - Bad request
- 401 - Unauthorized
- 403 - Forbidden
- 404 - Not found
- 500 - Server error

‚úÖ **Pagination:**
```json
{
  "items": [...],
  "total": 100,
  "skip": 0,
  "limit": 10
}
```

‚úÖ **Error Format:**
```json
{
  "detail": "Error message",
  "code": "ERROR_CODE",
  "field": "field_name"
}
```

### API Versioning

- **Current:** v1
- **Prefix:** `/api/v1/*`
- **Future:** `/api/v2/*` khi c√≥ breaking changes

---

## Scalability

### Horizontal Scaling

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Load Balancer‚îÇ
                    ‚îÇ   (NGINX)    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ                ‚îÇ                ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ API     ‚îÇ      ‚îÇ API     ‚îÇ     ‚îÇ API     ‚îÇ
     ‚îÇ Server 1‚îÇ      ‚îÇ Server 2‚îÇ     ‚îÇ Server 3‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                ‚îÇ                ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   MongoDB    ‚îÇ
                    ‚îÇ   Cluster    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Performance Optimizations

1. **Database:**
   - Indexes tr√™n frequent queries
   - Connection pooling
   - Read replicas

2. **Caching:**
   - Redis cho sessions
   - Cache course listings
   - Cache user profiles

3. **Async Processing:**
   - Background tasks cho email
   - Async indexing cho RAG
   - Queue system (Celery)

4. **CDN:**
   - Static files
   - Course materials
   - Profile images

### Monitoring

- **Metrics:** Prometheus + Grafana
- **Logs:** ELK Stack / CloudWatch
- **Errors:** Sentry
- **APM:** New Relic / Datadog
- **Uptime:** UptimeRobot

---

## Deployment Strategy

### Environments

1. **Development** - Local machines
2. **Staging** - Cloud test environment
3. **Production** - Production servers

### CI/CD Pipeline

```
Code Push ‚îÄ‚îÄ‚ñ∂ GitHub ‚îÄ‚îÄ‚ñ∂ GitHub Actions
                            ‚îÇ
                            ‚ñº
                    Run Tests (pytest)
                            ‚îÇ
                            ‚ñº
                    Build Docker Image
                            ‚îÇ
                            ‚ñº
                    Push to Registry
                            ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚ñº                ‚ñº
                Staging         Production
                Deploy          Deploy
```

### Backup Strategy

- **Database:** Daily automated backups
- **Retention:** 30 days
- **Storage:** S3/Cloud Storage
- **Recovery:** Point-in-time restore

---

## Security Considerations

### OWASP Top 10 Protection

‚úÖ **A01 - Broken Access Control:** RBAC implemented  
‚úÖ **A02 - Cryptographic Failures:** Bcrypt, JWT, HTTPS  
‚úÖ **A03 - Injection:** Pydantic validation, NoSQL (MongoDB)  
‚úÖ **A04 - Insecure Design:** Secure architecture  
‚úÖ **A05 - Security Misconfiguration:** Environment configs  
‚úÖ **A06 - Vulnerable Components:** Regular updates  
‚úÖ **A07 - Authentication Failures:** JWT, rate limiting  
‚úÖ **A08 - Data Integrity:** Input validation  
‚úÖ **A09 - Logging Failures:** Comprehensive logging  
‚úÖ **A10 - SSRF:** URL validation  

---

## Conclusion

H·ªá th·ªëng BE Learning AI ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi:
- ‚úÖ **Scalability** - C√≥ th·ªÉ m·ªü r·ªông d·ªÖ d√†ng
- ‚úÖ **Maintainability** - Code r√µ r√†ng, d·ªÖ b·∫£o tr√¨
- ‚úÖ **Security** - B·∫£o m·∫≠t nhi·ªÅu l·ªõp
- ‚úÖ **Performance** - T·ªëi ∆∞u h√≥a t·ªët
- ‚úÖ **AI-Powered** - T√≠ch h·ª£p AI v√† RAG

Ki·∫øn tr√∫c n√†y s·∫µn s√†ng cho production v√† c√≥ th·ªÉ scale l√™n h√†ng ngh√¨n users.

---

**T√†i li·ªáu b·ªï sung:**
- [SETUP_GUIDE.md](SETUP_GUIDE.md) - H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t
- [DEPLOYMENT.md](DEPLOYMENT.md) - H∆∞·ªõng d·∫´n deploy
- [VECTOR_STORAGE.md](VECTOR_STORAGE.md) - RAG implementation

**C·∫≠p nh·∫≠t:** October 2025  
**Version:** 1.0.0
